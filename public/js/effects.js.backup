// Enhanced Visual Effects System

// Confetti burst effect
function triggerConfetti(x = window.innerWidth / 2, y = window.innerHeight / 2) {
    const colors = ['#667eea', '#764ba2', '#f093fb', '#f5576c', '#4facfe', '#00f2fe', '#43e97b', '#38f9d7'];
    const confettiCount = 50;
    
    for (let i = 0; i < confettiCount; i++) {
        const confetti = document.createElement('div');
        confetti.className = 'confetti';
        confetti.style.left = x + 'px';
        confetti.style.top = y + 'px';
        confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
        confetti.style.width = (Math.random() * 10 + 5) + 'px';
        confetti.style.height = confetti.style.width;
        confetti.style.position = 'fixed';
        confetti.style.zIndex = '10000';
        confetti.style.pointerEvents = 'none';
        confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
        
        const angle = Math.random() * Math.PI * 2;
        const velocity = Math.random() * 10 + 5;
        const vx = Math.cos(angle) * velocity;
        const vy = Math.sin(angle) * velocity - 10;
        
        confetti.style.setProperty('--vx', vx + 'px');
        confetti.style.setProperty('--vy', vy + 'px');
        
        document.body.appendChild(confetti);
        
        confetti.animate([
            { 
                transform: 'translate(0, 0) rotate(0deg)',
                opacity: 1
            },
            { 
                transform: `translate(calc(var(--vx) * 30), calc(var(--vy) * 10 + 100vh)) rotate(${Math.random() * 720}deg)`,
                opacity: 0
            }
        ], {
            duration: 2000 + Math.random() * 1000,
            easing: 'cubic-bezier(0.25, 0.46, 0.45, 0.94)'
        }).onfinish = () => confetti.remove();
    }
}

// Success ripple effect
function triggerSuccessRipple(element) {
    const ripple = document.createElement('div');
    ripple.style.position = 'absolute';
    ripple.style.borderRadius = '50%';
    ripple.style.background = 'rgba(67, 233, 123, 0.5)';
    ripple.style.width = '20px';
    ripple.style.height = '20px';
    ripple.style.pointerEvents = 'none';
    ripple.style.left = '50%';
    ripple.style.top = '50%';
    ripple.style.transform = 'translate(-50%, -50%)';
    ripple.style.zIndex = '1000';
    
    element.style.position = 'relative';
    element.appendChild(ripple);
    
    ripple.animate([
        { transform: 'translate(-50%, -50%) scale(0)', opacity: 1 },
        { transform: 'translate(-50%, -50%) scale(5)', opacity: 0 }
    ], {
        duration: 600,
        easing: 'ease-out'
    }).onfinish = () => ripple.remove();
}

// Shake animation for errors
function shakeElement(element) {
    element.style.animation = 'none';
    setTimeout(() => {
        element.style.animation = 'shake 0.5s';
    }, 10);
    
    setTimeout(() => {
        element.style.animation = '';
    }, 500);
}

// Glow effect on hover
function addGlowEffect(selector) {
    document.querySelectorAll(selector).forEach(el => {
        el.addEventListener('mouseenter', function() {
            this.style.filter = 'drop-shadow(0 0 20px currentColor)';
            this.style.transition = 'filter 0.3s ease';
        });
        
        el.addEventListener('mouseleave', function() {
            this.style.filter = '';
        });
    });
}

// Add sparkle trail to cursor
let sparkleInterval;
function enableSparkleTrail() {
    let lastSparkle = 0;
    document.addEventListener('mousemove', (e) => {
        const now = Date.now();
        if (now - lastSparkle < 50) return;
        lastSparkle = now;
        
        const sparkle = document.createElement('div');
        sparkle.style.position = 'fixed';
        sparkle.style.left = e.clientX + 'px';
        sparkle.style.top = e.clientY + 'px';
        sparkle.style.width = '4px';
        sparkle.style.height = '4px';
        sparkle.style.borderRadius = '50%';
        sparkle.style.background = 'white';
        sparkle.style.pointerEvents = 'none';
        sparkle.style.zIndex = '9999';
        sparkle.style.boxShadow = '0 0 10px rgba(255, 255, 255, 0.8)';
        
        document.body.appendChild(sparkle);
        
        sparkle.animate([
            { transform: 'scale(1)', opacity: 1 },
            { transform: 'scale(0)', opacity: 0 }
        ], {
            duration: 500,
            easing: 'ease-out'
        }).onfinish = () => sparkle.remove();
    });
}

// Magnetic button effect
function addMagneticEffect(selector) {
    document.querySelectorAll(selector).forEach(button => {
        button.addEventListener('mousemove', function(e) {
            const rect = this.getBoundingClientRect();
            const x = e.clientX - rect.left - rect.width / 2;
            const y = e.clientY - rect.top - rect.height / 2;
            
            this.style.transform = `translate(${x * 0.3}px, ${y * 0.3}px) scale(1.05)`;
        });
        
        button.addEventListener('mouseleave', function() {
            this.style.transform = '';
        });
    });
}

// Text typing effect
function typeWriter(element, text, speed = 50) {
    let i = 0;
    element.textContent = '';
    
    function type() {
        if (i < text.length) {
            element.textContent += text.charAt(i);
            i++;
            setTimeout(type, speed);
        }
    }
    
    type();
}

// Pulse effect for notifications
function pulseElement(element, duration = 1000) {
    element.animate([
        { transform: 'scale(1)', opacity: 1 },
        { transform: 'scale(1.1)', opacity: 0.8 },
        { transform: 'scale(1)', opacity: 1 }
    ], {
        duration: duration,
        iterations: 3
    });
}

// Initialize effects on page load
document.addEventListener('DOMContentLoaded', () => {
    // Add glow to interactive elements
    addGlowEffect('.btn, .nav-link, .card');
    
    // Add magnetic effect to buttons
    addMagneticEffect('.btn, .login-btn');
    
    // Enable sparkle trail on special pages
    if (window.location.pathname === '/' || window.location.pathname === '/dashboard') {
        // enableSparkleTrail(); // Commented out by default - uncomment for extra sparkle!
    }
    
    // Add success ripple to form submissions
    document.querySelectorAll('form').forEach(form => {
        form.addEventListener('submit', function(e) {
            const submitBtn = this.querySelector('button[type="submit"], input[type="submit"]');
            if (submitBtn) {
                triggerSuccessRipple(submitBtn);
            }
        });
    });
    
    // Add confetti on grade improvements
    document.querySelectorAll('.grade-a, .grade-b').forEach(el => {
        el.addEventListener('click', function(e) {
            triggerConfetti(e.clientX, e.clientY);
        });
    });
});

// Export functions for use in other scripts
window.visualEffects = {
    triggerConfetti,
    triggerSuccessRipple,
    shakeElement,
    addGlowEffect,
    enableSparkleTrail,
    addMagneticEffect,
    typeWriter,
    pulseElement
};
